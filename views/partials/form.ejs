  <div ng-controller="FormCtrl">
    <h1 class="ui header">
      Sélection des logs
      <div class="sub header">Indiquez ici les logs que vous désirez faire analyser par ezPAARSE. Vos logs nécessitent peut-être un paramétrage particulier pour qu'ezPAARSE les comprenne. Si nécessaire, <a class="feedback-toggle">contactez l'équipe ezPAARSE</a> pour une aide au paramétrage.</div>
    </h1>

    <div class="bottom-padded-group">
      <div><button id="settings-button" class="ui left labeled icon mini button block"><i class="settings icon"></i> Paramètres</button></div>
      <div><select id="predefined-settings" class="chosen-select-deselect" data-placeholder="Choix d'un paramétrage prédéfini..." data-no_results_text="Aucun résultat pour" ez-chosen>
        <option value="" selected=""></option>
        <option value="INISTCNRS">INIST-CNRS</option>
        <option value="ULorraine">Université de Lorraine</option>
        <option value="UParisDApache">Université Paris Descartes Apache</option>
        <option value="UParisDBibliopam">Université Paris Descartes Bibliopam</option>
        <option value="EPFL">École polytechnique fédérale de Lausanne</option>
        <option value="URennes1">Université de Rennes 1</option>
        <option value="URennes2">Université de Rennes 2</option>
        <option value="ULyon1">Université Lyon 1</option>
        <option value="ULyon">Université Lyon 3</option>
        <option value="UPMCezproxy">UPMC ezproxy</option>
        <option value="UPMCsquid">UPMC squid</option>
        <option value="UStrasbourg">Université de Strasbourg</option>
        <option value="UToulouse">Université de Toulouse</option>
        <option value="ULimoges">Université de Limoges</option>
        <option value="UMontpellier3">Université de Montpellier 3</option>
        <option value="INRIA">INRIA</option>
        <option value="UParis1">Université Paris 1</option>
        <option value="UParis11">Université Paris 11</option>
        <option value="UPEC">Université Paris-Est Créteil (UPEC)</option>
        <option value="UVHC">Université de Valenciennes et du Hainaut-Cambrésis</option>
        <option value="ExempleOutput">Exemple selection sortie</option>
        <option value="Lara">Lara</option>
      </select></div>
    </div>

    <div class="ui top attached tabular menu">
      <a class="active item" data-tab="file">Fichiers de logs</a>
      <a class="item" data-tab="direct-input">Copier/coller de logs</a>
    </div>
    <div class="ui bottom attached active tab segment" data-tab="file">
      <input type="file" style="display: none;" id="input-file" onchange="angular.element(this).scope().selectFiles(this)" multiple>

      <div class="ui dimmable dropzone segment" ez-file-drop="addFiles">
        <div class="ui dimmer">
          <div class="content"><div class="center">
            <div class="ui tiny icon header">
              <i class="download icon"></i>
              Déposez les fichiers ici
            </div>
          </div></div>
        </div>

        <p><button class="ui small basic button" ez-trigger-click="#input-file">
          <i class="plus icon"></i>
          Cliquez pour ajouter
        </button></p>
        <!-- <p class="text">Ou déposez vos fichiers de logs ici</p> -->
        <table ng-if="files.length" class="ui small compact basic table">
        <thead><tr>
          <th class="twelve wide">Nom de fichier</th>
          <th class="four wide">Taille</th>
        </tr></thead>
        <tbody>
          <tr ng-repeat="file in files">
            <td><i class="tiny delete link icon" ng-click="removeFile($index)"></i> {{ file.name }}</td>
            <td>{{ file.size | bytesToSize }}</td>
          </tr>
        </tbody>
        <tfoot><tr>
          <th>{{ files.length }} fichiers sélectionnés</th>
          <th>{{ totalSize | bytesToSize }} au total</th>
        </tr></tfoot>
      </table>
      </div>
    </div>
    <div class="ui bottom attached tab segment" data-tab="direct-input">
      <div class="ui form field">
        <label for="log-lines">Copiez/coller vos lignes de log ici</label>
        <textarea id="log-lines"></textarea>
      </div>
    </div>

    <div class="ui active progress" ng-class="progress < 100 ? 'blue':'green'">
      <div class="bar" ng-style="progressStyle" ng-switch on="progress">
        <span ng-switch-default>{{ progress }}%</span>
        <span ng-switch-when="100">Terminé</span>
      </div>
    </div>

    <div class="ui center aligned basic segment">
      <div class="ui huge buttons">
        <button ng-click="start()" class="ui teal button">Traiter vos logs</button>
        <button class="ui icon teal button" title="Traiter avec cURL"><i class="copy small icon"></i></button>
      </div>
    </div>

    <div id="settings-modal" class="ui scrollable modal" ez-attached-to="#settings-button">
      <i class="inverted close icon"></i>
      <div class="ui left floated header">
        Paramètres
      </div>
      <div class="ui right floated basic segment">
        <div class="ui slider checkbox">
          <input id="rememberToggle" type="checkbox" ng-model="settings.remember">
          <label for="rememberToggle">Mémoriser mes paramètres</label>
        </div>
      </div>
      <div class="ui form content">
        <div class="ui teal dividing header">En entrée</div>
        <div class="three fields">

          <div class="field">
            <label>Format de date</label>
            <input ng-hide="showHelp" placeholder="DD/MMM/YYYY:HH:mm:ss Z" type="text" ng-model="settings.dateFormat">
            <div ng-show="showHelp" class="ui inverted teal bottom attached segment">Format de date des lignes de log.</div>
          </div>

          <div class="field">
            <label>Domaine relatif</label>
            <input ng-hide="showHelp" placeholder="www.domain.com" type="text" ng-model="settings.relativeDomain">
            <div ng-show="showHelp" class="ui inverted teal bottom attached segment">Domaine à utiliser pour les URLs relatives.</div>
          </div>

          <div class="field">
            <label>Encodage du texte</label>
            <select ng-hide="showHelp" ng-model="settings.inputEncoding" ng-options="e for e in encodings"></select>
            <div ng-show="showHelp" class="ui inverted teal bottom attached segment">Jeu de caractères (charset) utilisé dans les fichiers à traiter.</div>
          </div>

        </div>
        <div class="four fields">
          <div class="select field">
            <label>Type de log</label>
            <select ng-hide="showHelp" ng-model="settings.proxyType" ng-options="proxy for proxy in proxyTypes">
              <option value="">Reconnaissance auto</option>
            </select>
            <div ng-show="showHelp" class="ui inverted teal bottom attached segment">Plateforme d'origine des log.</div>
          </div>

          <div class="three wide field" ng-show="settings.proxyType || showHelp">
            <label>Format de log</label>
            <textarea ng-hide="showHelp" placeholder="%h %t %r %s" type="text" ng-model="settings.logFormat"></textarea>
            <div ng-show="showHelp" class="ui inverted teal bottom attached segment">Format des lignes de log (Ex: '%h %l %u %t %s %b'). <a href='/doc/formats.html' target='_blank'>En savoir plus</a></div>
          </div>
        </div>

        <div class="ui red dividing header">En sortie</div>
        <div class="three fields">
          <div class="field">
            <label>Format du résultat</label>
            <select ng-hide="showHelp" ng-model="settings.resultFormat" ng-options="f.mime as f.type for f in resultFormats"></select>
            <div ng-show="showHelp" class="ui inverted red bottom attached segment">Format des données en sortie.</div>
          </div>

          <div class="field">
            <label>Traces système</label>
            <select ng-hide="showHelp" ng-model="settings.tracesLevel" ng-options="t.level as t.desc for t in tracesLevels"></select>
            <div ng-show="showHelp" class="ui inverted red bottom attached segment">Niveau de verbosité des traces laissées durant le traitement.</div>
          </div>

          <div class="field">
            <label>Encodage du texte</label>
            <select ng-hide="showHelp" ng-model="settings.outputEncoding" ng-options="e for e in encodings"></select>
            <div ng-show="showHelp" class="ui inverted red bottom attached segment">Jeu de caractères (charset) utilisé dans les données en sortie.</div>
          </div>
        </div>
        <div class="three fields">
          <div class="field">
            <label>Champs en sortie</label>
            <div class="two fields" ng-hide="showHelp">
              <div class="field">
                <form ng-submit="addField('plus')">
                  <div class="ui action input">
                    <input type="text" placeholder="Ajouter..." ng-model="plusField">
                    <div ng-click="addField('plus')" class="ui orange icon button">
                      <i class="plus icon"></i>
                    </div>
                  </div>
                </form>
              </div>

              <div class="field">
                <form ng-submit="addField('minus')">
                  <div class="ui action input">
                    <input type="text" placeholder="Enlever..." ng-model="minusField">
                    <div ng-click="addField('minus')" class="ui purple icon button"><i class="minus icon"></i></div>
                  </div>
                </form>
              </div>
            </div>

            <div class="inline-labels field" ng-hide="showHelp">
              <div class="ui normalized label" ng-class="{plus: 'orange', minus: 'purple'}[field.type]" ng-repeat="field in settings.outputFields | orderBy:'type'">
                {{ field.name }}
                <i class="delete icon" ng-click="removeField($index, $event)"></i>
              </div>
            </div>

            <div ng-show="showHelp" class="ui inverted red bottom attached segment">Champs (en-têtes) à ajouter/enlever dans le fichier de sortie.</div>
          </div>
        </div>

        <div class="ui right aligned basic segment">
          <div class="ui right labeled mini icon button" ng-click="loadDefault()"><i class="repeat icon"></i> Paramètres par défaut</div>
          <div class="ui right mini icon button" ng-class="{true: 'purple', false: 'black'}[showHelp]" ng-click="toggleHelp()">
            <i class="help icon"></i>
            {{ showHelp ? "Masquer l'aide" : "Afficher l'aide" }}
          </div>
        </div>
      </div>
      <div class="actions">
        <div class="ui positive left labeled icon button"><i class="checkmark icon"></i> OK​</div>
      </div>
    </div>
  </div>
